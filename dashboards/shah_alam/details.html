<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Detail Kes</title>
<style>
body{font-family:Arial;padding:20px;}
.card{
  border:1px solid #ccc;
  padding:15px;
  margin-bottom:10px;
  border-radius:6px;
}
a{color:#0066ff;text-decoration:none;}
</style>
</head>
<body>

<h2>Detail Aduan</h2>
<div id="result">Loading...</div>

<script>
// ===== SECURITY GATE =====
if(sessionStorage.getItem("operanix_auth") !== "ok"){
  window.location.href = "login.html";
}
// =========================

const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-XXXXX/pub?output=csv";

const urlParams = new URLSearchParams(window.location.search);
const caseId = urlParams.get('case_id');

fetch(csvUrl)
.then(r=>r.text())
.then(text=>{
  const rows = text.trim().split('\n').slice(1);
  let found = false;

  rows.forEach(row=>{
    const cols = row.split(',');

    if(cols[0].trim() === caseId.trim()){
      found = true;

      const case_id    = cols[0];
      const tarikh     = cols[1];
      const kategori   = cols[3];
      const ringkasan = cols[4];
      const status    = cols[5] || "";
      const lat        = parseFloat(cols[6]);
      const lng        = parseFloat(cols[7]);

      // ===== WAZE LINK =====
      const wazeLink = `https://waze.com/ul?ll=${lat},${lng}&navigate=yes`;

      document.getElementById('result').innerHTML = `
        <div class="card">
          <b>Case ID:</b> ${case_id}<br>
          <b>Tarikh:</b> ${tarikh}<br>
          <b>Kategori:</b> ${kategori}<br>
          <b>Ringkasan:</b> ${ringkasan}<br>
          <b>Status:</b> ${status}<br><br>

          <a href="${wazeLink}" target="_blank"
             style="
               display:inline-block;
               background:#2bbd6e;
               color:white;
               padding:8px 14px;
               border-radius:6px;
               font-weight:bold;
             ">
             üß≠ Navigasi Waze
          </a>
        </div>

        <a href="index.html">‚Üê Kembali ke Peta</a>
      `;
    }
  });

  if(!found){
    document.getElementById('result').innerHTML = "Kes tidak dijumpai";
  }
});
</script>

</body>
</html>
