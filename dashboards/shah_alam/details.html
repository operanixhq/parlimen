<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Detail Kes</title>
<style>
body{font-family:Arial;padding:20px;}
.card{border:1px solid #ccc;padding:15px;margin-bottom:10px;border-radius:8px;}
a{color:#0066ff;text-decoration:none;font-weight:bold;}
</style>
</head>
<body>

<script>
if(sessionStorage.getItem("operanix_auth") !== "ok"){
    sessionStorage.setItem("operanix_redirect", window.location.href);
    window.location.href = "login.html";
}
</script>

<h2>Detail Aduan</h2>
<div id="result">Loading...</div>

<script>
const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTXBgy7se3-U4mSHdnbZ6YiRYToQEVFtEKuZ_z_RRCby7nYGd-HViMSNexPxFHP2pENCUjkX3ofqqlE/pub?output=csv";

const urlParams = new URLSearchParams(window.location.search);
const caseId = urlParams.get('case_id');

fetch(csvUrl)
.then(r=>r.text())
.then(text=>{
  const rows = text.trim().split("\n").slice(1);
  let found = false;

  rows.forEach(row=>{
    const cols = row.split(",");

    if(cols[0].trim() === caseId.trim()){
      found = true;

      const lat = cols[6];
      const lng = cols[7];
      const wazeLink = `https://waze.com/ul?ll=${lat},${lng}&navigate=yes`;

      document.getElementById('result').innerHTML = `
        <div class="card">
          <b>Case ID:</b> ${cols[0]}<br>
          <b>Tarikh:</b> ${cols[1]}<br>
          <b>Kategori:</b> ${cols[3]}<br>
          <b>Ringkasan:</b> ${cols[4]}<br>
          <b>Status:</b> ${cols[5]}<br><br>
          <a href="${wazeLink}" target="_blank">üß≠ Buka Waze</a>
        </div>
        <a href="index.html">‚Üê Kembali ke Peta</a>
      `;
    }
  });

  if(!found){
    document.getElementById('result').innerHTML="Kes tidak dijumpai";
  }
});
</script>
</body>
</html>
